<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Workshop Projects</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f8fafc; }
        .card { transition: all 0.2s; }
        .card:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
    </style>
</head>
<body class="p-8 max-w-5xl mx-auto">

    <div class="mb-10 text-center">
        <h1 class="text-4xl font-bold text-slate-800 mb-2">Workshop Project Hub</h1>
        <p class="text-slate-500">A collection of woodworking tools & plans</p>
    </div>

    <div id="loading" class="text-center py-20">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
        <p class="text-slate-500">Scanning repository for projects...</p>
    </div>

    <div id="error-msg" class="hidden bg-red-50 border border-red-200 text-red-700 p-4 rounded text-center mb-6"></div>

    <!-- Projects Grid -->
    <div id="project-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <!-- JS will inject cards here -->
    </div>

    <div class="mt-12 text-center text-xs text-slate-400 border-t pt-4">
        Auto-generated by GitHub API
    </div>

    <script>
        async function loadProjects() {
            const grid = document.getElementById('project-grid');
            const loader = document.getElementById('loading');
            const errorDiv = document.getElementById('error-msg');

            try {
                // 1. Auto-detect User and Repo from URL
                // Expected format: https://[user].github.io/[repo]/
                const pathParts = window.location.pathname.split('/').filter(p => p);
                const hostParts = window.location.hostname.split('.');

                let user = hostParts[0];
                let repo = pathParts[0];

                // Localhost fallback for testing
                if (window.location.hostname === 'localhost' || window.location.protocol === 'file:') {
                    // You can hardcode these for local testing if needed
                    // user = 'your-username';
                    // repo = 'your-repo-name';
                    throw new Error("This magic index only works when hosted on GitHub Pages (it needs the URL to find the API).");
                }

                // 2. Query GitHub API
                const apiUrl = `https://api.github.com/repos/${user}/${repo}/contents/`;
                const response = await fetch(apiUrl);
                
                if (!response.ok) throw new Error(`GitHub API Error: ${response.status}`);
                
                const files = await response.json();

                // 3. Filter & Sort Files
                const htmlFiles = files
                    .filter(f => f.name.endsWith('.html'))     // Only HTML
                    .filter(f => f.name !== 'index.html')      // Don't list self
                    .filter(f => f.name !== '404.html');       // Don't list errors

                loader.classList.add('hidden');

                if (htmlFiles.length === 0) {
                    errorDiv.textContent = "No project files found yet! Upload some .html files to see them here.";
                    errorDiv.classList.remove('hidden');
                    return;
                }

                // 4. Generate Cards
                htmlFiles.forEach(file => {
                    // Format the name (remove .html, replace underscores with spaces)
                    const displayName = file.name
                        .replace('.html', '')
                        .replace(/_/g, ' ')
                        .replace(/-/g, ' ')
                        .replace(/\b\w/g, l => l.toUpperCase()); // Title Case

                    const card = document.createElement('a');
                    card.href = file.name;
                    card.className = "card bg-white p-6 rounded-xl border border-slate-200 block hover:border-blue-400 group";
                    card.innerHTML = `
                        <div class="flex items-center justify-between mb-4">
                            <div class="bg-blue-100 text-blue-600 p-3 rounded-lg group-hover:bg-blue-600 group-hover:text-white transition-colors">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                                </svg>
                            </div>
                            <span class="text-xs font-mono text-slate-400">${file.size > 1024 ? (file.size/1024).toFixed(0) + ' KB' : file.size + ' B'}</span>
                        </div>
                        <h2 class="text-xl font-bold text-slate-800 mb-1 group-hover:text-blue-700">${displayName}</h2>
                        <p class="text-sm text-slate-500">Click to open tool</p>
                    `;
                    grid.appendChild(card);
                });

            } catch (err) {
                loader.classList.add('hidden');
                errorDiv.innerHTML = `<strong>Error:</strong> ${err.message}<br><span class="text-sm">Make sure this file is hosted on GitHub Pages.</span>`;
                errorDiv.classList.remove('hidden');
            }
        }

        loadProjects();
    </script>
</body>
</html>